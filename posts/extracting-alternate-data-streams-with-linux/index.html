<!DOCTYPE html><html lang="en-UK" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content=""><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Extracting Alternate Data Streams with Linux" /><meta name="author" content="Mairi" /><meta property="og:locale" content="en_UK" /><meta name="description" content="Foreword" /><meta property="og:description" content="Foreword" /><link rel="canonical" href="https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/" /><meta property="og:url" content="https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/" /><meta property="og:site_name" content="Mairi’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-06-22T01:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Extracting Alternate Data Streams with Linux" /><meta name="twitter:site" content="@AstrumMairi" /><meta name="twitter:creator" content="@Mairi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mairi"},"dateModified":"2018-06-22T01:00:00+01:00","datePublished":"2018-06-22T01:00:00+01:00","description":"Foreword","headline":"Extracting Alternate Data Streams with Linux","mainEntityOfPage":{"@type":"WebPage","@id":"https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/"},"url":"https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/"}</script><title>Extracting Alternate Data Streams with Linux | Mairi's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/LOGO.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mairi's Blog</a></div><div class="site-subtitle font-italic">Science, Research & Development</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/TMairi" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/AstrumMairi" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Extracting Alternate Data Streams with Linux</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Extracting Alternate Data Streams with Linux</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Mairi </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jun 22, 2018, 1:00 AM +0100" prep="on" > Jun 22 <i class="unloaded">2018-06-22T01:00:00+01:00</i> </span></div><div></div></div><div class="post-content"><h2 id="foreword">Foreword</h2><p>This article will be covering a feature of the NTFS file system known as the Alternate Data Stream (ADS), focusing on how to properly identify and extract these data streams from an NTFS volume using a Linux host.</p><blockquote><p><strong>DISCLAIMER</strong>: This article was written by myself and was previously posted on a now-defunct website on 2018-06-22. I backed up the original contents of the article prior to the website shut-down and am now reposting it here for preservation. All information was correct and accurate at the time this article was written.</p></blockquote><h2 id="alternate-data-streams">Alternate Data Streams</h2><p>Despite being talked about fairly regularly in the forensic community, Alternate Data Streams (ADS) are not a well-known feature of the NTFS file system, nor are they officially well-documented. ADS was first implemented into Windows NT 3.1 to allow compatibility with the Hierarchical File System (HFS), designed for Macintosh systems at the time. The reason for this was tied into how HFS stores data using two main components; a <code class="language-plaintext highlighter-rouge">data</code> fork and a <code class="language-plaintext highlighter-rouge">resource</code> fork. On HFS, the data fork comprised the actual data and the resource fork was used by the host Operating System to interpret the data. This functionality is analogous to file extensions on Windows systems<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p><p>The Alternate Data Stream on the Windows NTFS file system was designed to play the part of the resource fork for HFS; providing Windows with a way to interpret the data on HFS volumes. Bear in mind that all files in NTFS consist of at least one visible data stream, usually referred to as the MFT attribute <code class="language-plaintext highlighter-rouge">$DATA</code> or the ‘unnamed data stream’<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>.</p><p>An ADS is simply another data stream attached to a given file which is hidden from the user and even programs such as Windows Explorer. Some files on Windows systems will commonly incorporate multiple data streams, such as for the purpose of holding metadata. For example; a Microsoft Word document will often contain metadata (author, word count, page number, etc.) that is attached to the document via an ADS. When understanding ADS, it is easier to think of them as hidden files that are ‘attached’ to visible ones.</p><h3 id="abusing-alternate-data-streams">Abusing Alternate Data Streams</h3><p>The ability to add another data stream to any file on NTFS, which is not only hidden from the user but difficult for security programs to detect, carries a high potential for abuse. Penetration testers sometimes use ADS to bypass expected behaviour in applications which do not account for input including an Alternate Data Stream. A historical vulnerability involving the abuse of ADS was seen in <a href="https://nvd.nist.gov/vuln/detail/CVE-1999-0278">CVE-1999-0278</a>, wherein attackers using Internet Information Services (IIS) could obtain source code for ASP files simply by appending the string <code class="language-plaintext highlighter-rouge">::$DATA</code> to the URL.</p><p>Alternate Data Streams on NTFS also exhibit unique qualities which make them a desirable target for attackers wishing to abuse them<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>:</p><ul><li>No attributes<li>Unreported Size<li>No size limitations<li>Multiple streams per file<li>Can affect directories and drives<li>Difficult to unintentionally access<li>Often go undetected by security programs</ul><p>A common method attackers employ to abuse Alternate Data Streams is to add an executable payload to any file on the NTFS file system, which can then be executed with specific commands, without the users knowledge. Removing a malicious ADS is as simple as deleting the file it is attached to. However, should the ADS be attached to a critical system file such as the root of the file system, this would be much harder to reliably remove.</p><h3 id="forensic-relevance">Forensic Relevance</h3><p>From a forensic perspective, NTFS Alternate Data Streams have severe implications for Anti-Forensics, as an attacker could potentially hide multiple incriminating files or malicious payloads through hidden data streams on other files. However, these Alternate Data Streams are not hidden or exempt from forensic analysis programs, as will be demonstrated later. Additionally, there are applications available to forensic examiners that are purposefully designed to detect hidden data streams on an NTFS system, such as<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>:</p><ul><li><a href="https://www.aldeid.com/wiki/LADS">LADS</a><li><a href="http://ntsecurity.nu/toolbox/lns/">LNS</a><li>PowerShell<li><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/streams">Streams</a></ul><p>These tools are mostly Windows-based and some of them are required to be executed on a live file system, which may not be considered forensically sound, especially if employed in a live forensic scenario. After researching the role of data streams on NTFS, I was naturally curious as to whether I could detect and forensically extract Alternate Data Streams using Linux. This observation and subsequent research into ADS formed the basis for a hypothesis, from which I conducted an experiment into whether Linux tools have the capability to detect ADS on an NTFS image file.</p><h2 id="experimentation">Experimentation</h2><h3 id="assumption-and-methodology">Assumption and Methodology</h3><p>The assumption during these tests is that a forensic examiner has obtained a Windows NTFS image file and they want to run commands from a Linux-based host to ensure that nothing is hidden via suspicious data streams. With this in mind, I created a simple methodology for the experiment as follows:</p><ol><li>Create a Windows 10 Virtual Machine<li>Create some superfluous ADS using the Command Prompt<li>Convert the VMDK image to RAW format<li>Forensically mount the image on Linux<li>Identify ADS using relevant commands<li>Extract any suspicious ADS from the disk image</ol><h3 id="testing">Testing</h3><p>Firstly, I created a clean Windows 10 (Build Version 1803) virtual machine with VMWare Workstation 12 and used a single 40GB disk image file during the installation process. The next step was to create some exemplary Alternate Data Streams using the Windows Command Prompt <code class="language-plaintext highlighter-rouge">cmd.exe</code><sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote" rel="footnote">5</a></sup>:</p><pre><code class="language-cmd">echo “First Alternate Data Stream” &gt; test.txt:hidden.txt
type C:\Windows\System32\notepad.exe &gt; important.docx:hidden.exe
</code></pre><p>The first command shown above creates a simple ADS text file <code class="language-plaintext highlighter-rouge">hidden.txt</code>, the content of which having been redirected from an <code class="language-plaintext highlighter-rouge">echo</code> command consisting of the string <em>“First Alternate Data Stream”</em>. Note that the main data stream <code class="language-plaintext highlighter-rouge">test.txt</code>, does not need to exist beforehand and the result will be an empty text file with the hidden ADS file attached to it.</p><p>The second command shown above demonstrates how an executable file could be attached as an Alternate Data Stream. In this case, the <code class="language-plaintext highlighter-rouge">type</code> command (similar to Linux <code class="language-plaintext highlighter-rouge">cat</code>), is used to display the contents of the default <code class="language-plaintext highlighter-rouge">notepad.exe</code> program, which is then redirected to an ADS <code class="language-plaintext highlighter-rouge">hidden.exe</code>, attached to another empty file <code class="language-plaintext highlighter-rouge">important.docx</code>.</p><p>Running a <code class="language-plaintext highlighter-rouge">dir</code> command on the directory containing the superfluous ADS files will only show the contents and basic properties (file size) of the empty files they are attached to, with no indication that Alternate Data Streams exist. However, it should be noted that running <code class="language-plaintext highlighter-rouge">dir /s /r</code> on the same directory <strong>will</strong> display the hidden data stream.</p><p>It is worth pointing out that at this stage of the testing; as long as your Windows system incorporates PowerShell version 3.0 (or later), you can read from and write to Alternate Data Streams using PS commands. You can utilise the <code class="language-plaintext highlighter-rouge">Get-ChildItem</code> (GCI) PowerShell command to recursively check a directory for Alternate Data Streams<sup id="fnref:6" role="doc-noteref"><a href="#fn:6" class="footnote" rel="footnote">6</a></sup>:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">gci</span><span class="w"> </span><span class="nt">-recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">gi</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="w"> </span><span class="nt">-stream</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="err">‘</span><span class="p">:</span><span class="nv">$Data</span><span class="err">’</span><span class="w">
</span></pre></table></code></div></div><p>The command shown above will recursively list the data streams associated with files in a given directory and through use of the <code class="language-plaintext highlighter-rouge">where</code> command, will show any data streams other than the default <code class="language-plaintext highlighter-rouge">$DATA</code>. Should a suspicious ADS be identified using this command, another PowerShell command can be issued to read the data it contains. This command is <code class="language-plaintext highlighter-rouge">Get-Content</code> and can be utilised as follows<sup id="fnref:7" role="doc-noteref"><a href="#fn:7" class="footnote" rel="footnote">7</a></sup>:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Get-Content</span><span class="w"> </span><span class="nt">-path</span><span class="w"> </span><span class="nx">C:\Users\Mairi\Documents\ADS_Test\test.txt</span><span class="w"> </span><span class="nt">-stream</span><span class="w"> </span><span class="nx">hidden.txt</span><span class="w">
</span></pre></table></code></div></div><p>In the above command; simply supply the <code class="language-plaintext highlighter-rouge">-path</code> parameter with the original file path and the <code class="language-plaintext highlighter-rouge">-stream</code> parameter with the name of the ADS as reported by <code class="language-plaintext highlighter-rouge">Get-ChildItem</code>. In the example used in this test, the content of the ADS was simply the text as created beforehand from the <code class="language-plaintext highlighter-rouge">echo</code> command.</p><p>With the ADS in place, the next step in the experimentation process is to forensically analyse the contents of the virtual machine disk image using a Linux host. Because I want the disk image file to be compatible with commands provided by the Sleuth Kit, the <code class="language-plaintext highlighter-rouge">VMDK</code> image first needs to be converted to the <code class="language-plaintext highlighter-rouge">RAW</code> image format. This can be achieved using the <code class="language-plaintext highlighter-rouge">qemu-img</code> command, typically provided by installing <a href="https://pkgs.org/download/qemu">QEMU</a> for Linux systems:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qemu-img convert <span class="nt">-O</span> raw &lt;INPUT&gt;.vmdk &lt;OUTPUT&gt;.raw
</pre></table></code></div></div><p>The length of this conversion process will be dependent on how large the input VMDK file is, but should result in the creation of a <code class="language-plaintext highlighter-rouge">RAW</code> image of the Windows virtual machine which can now be interrogated with Linux forensic tools.</p><p>The next step in the testing process is to attach the newly created <code class="language-plaintext highlighter-rouge">RAW</code> Windows disk image to a loop device, create the relevant partition mappings and then forensically mount the desired partition to a directory. This can be achieved using the following commands:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>mmls image.raw
kpartx <span class="nt">-av</span> image.raw
ntfsmount <span class="nt">-o</span> ro,streams_interface<span class="o">=</span>windows /dev/mapper/loop0p2 /mnt/Analysis/Windows
</pre></table></code></div></div><p>The partition mapping can be mounted using the normal Linux <code class="language-plaintext highlighter-rouge">mount</code> command, however I decided to use the NTFS driver for Linux instead because I could more reliably read information from any potential Alternate Data Streams that may be present on the image. The <code class="language-plaintext highlighter-rouge">ntfs-3g</code> driver can be easily <a href="https://pkgs.org/download/ntfs-3g">installed</a> on most mainstream distributions of Linux and provides the option to include all of the data streams associated with each file.</p><p>As shown above, the <code class="language-plaintext highlighter-rouge">RAW</code> disk image is first queried with the <code class="language-plaintext highlighter-rouge">mmls</code> command incorporated into the Sleuth Kit forensics tool to look at the partition layout of the virtual machine. The <code class="language-plaintext highlighter-rouge">kpartx</code> tool automatically creates a loop device for the disk image and dynamically adds partition mappings for the detected NTFS volumes. The desired partition is shown to be associated with the block device <code class="language-plaintext highlighter-rouge">/dev/mapper/loop0p2</code>, as the first mapping is simply Windows System Reserved. The <code class="language-plaintext highlighter-rouge">ntfsmount</code> command mounts the desired partition to a directory on the Linux system using the NTFS driver.</p><p>The <code class="language-plaintext highlighter-rouge">-o</code> parameter of the <code class="language-plaintext highlighter-rouge">ntfsmount</code> command specifies two things; mount the partition as read-only <code class="language-plaintext highlighter-rouge">ro</code> and preserve the ability to read named NTFS data streams <code class="language-plaintext highlighter-rouge">streams_interface=windows</code>. The last two arguments of this command simply specify the partition mapping containing the user data and where on the Linux system it is to be mounted.</p><p>With the virtual machine converted and successfully mounted, the next phase of the experiemnt is to begin identifying any Alternate Data Streams that may be present on the NTFS partition. However, even browsing to the directory where the superfluous ADS were created on the command-line will still not display the Alternate Data Streams.</p><p>Interestingly, the Alternate Data Streams can be viewed by reading the extended attributes of the mounted files using a Linux command called <code class="language-plaintext highlighter-rouge">getfattr</code>. This command is incorporated into most Linux distributions by default under the package <a href="https://pkgs.org/download/attr">attr</a>. Following the documentation for the NTFS driver, the ADS can be read by specifying the following extended attribute in <code class="language-plaintext highlighter-rouge">getfattr</code><sup id="fnref:8" role="doc-noteref"><a href="#fn:8" class="footnote" rel="footnote">8</a></sup>:</p><p><code class="language-plaintext highlighter-rouge">ntfs.streams.list</code></p><p>Additionally, the <code class="language-plaintext highlighter-rouge">getattr</code> command can be used recursively <code class="language-plaintext highlighter-rouge">-R</code> to search the entire NTFS partition for Alternate Data Streams and enumerate them:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>getfattr <span class="nt">-R</span> <span class="nt">-n</span> ntfs.stream.list /mnt/Analysis/Windows/ 2&gt;/dev/null | <span class="nb">grep</span> <span class="nt">-B1</span> <span class="o">=</span>
</pre></table></code></div></div><p>The output of the extended attributes display the superfluous Alternate Data Streams created at the start of the testing. Interestingly, other ADS were identified in the form of Zone Identifiers as part of Microsoft Edge, which is expected behaviour and not indicative of anything malicious.</p><p>With the Alternate Data Streams on this particular NTFS partition identified through the extended attributes, the command-set incorporated into the Sleuth Kit can be utilised to drill down on them as follows:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>fls <span class="nt">-o</span> 63 <span class="nt">-Frl</span> image.raw | <span class="nb">grep </span>ADS_Test
icat <span class="nt">-o</span> 63 image.raw 85330-128-2
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">fls</code> command was used to gather more information about the files previously located through the extended attributes. This command will automatically list the superfluous Alternate Data Streams and provide their independent inode number (MFT Entry Value). With this information, the contents of the ADS can be extracted using another Sleuth Kit command called <code class="language-plaintext highlighter-rouge">icat</code>. Using the above command, the content of <code class="language-plaintext highlighter-rouge">hidden.txt</code> was successfully extracted, in which the output can be redirected to another file on the host system if necessary for further analysis.</p><h2 id="data-analysis">Data Analysis</h2><p>I thought it would be beneficial to also include a few tests that I ran during the experimentation process which either did not work as intended or outright failed, just in case anyone can learn from them. Remember that the sole purpose of this experiment was to determine whether or not I could reliably extract information from NTFS Alternate Data Streams using nothing but Linux commands against a Windows disk image.</p><p>Originally, before I discovered that the extended attributes of the mounted NTFS partition could be read using <code class="language-plaintext highlighter-rouge">getfattr</code>, I was going to use PowerShell commands. In 2016, PowerShell was released by Microsoft as open-source and has been available ever since on their <a href="https://github.com/powershell/powershell">GitHub</a> repository. Interestingly, this repository also contains PS versions suited for Linux distributions such as; Arch, Debian, Ubuntu, CentOS, RHEL and Fedora.</p><p>Installing the RPM package on my Fedora distribution was easy and I could invoke a PowerShell prompt using the command <code class="language-plaintext highlighter-rouge">pwsh</code>. However, the PS commands I ran during the experiment would not work as intended, as the appropriate commands (<code class="language-plaintext highlighter-rouge">GCI</code> and <code class="language-plaintext highlighter-rouge">Get-Content</code>) lacked the ability to interact with data streams. I am still unsure as to precisely why this is, but I speculate that the version of PowerShell available for Linux is likely older than Version 3, which is required for ADS interaction.</p><p>I am well aware that mounting the NTFS partition normally using the Linux <code class="language-plaintext highlighter-rouge">mount -o ro,loop</code> command would work just as well as directly specifying the NTFS driver for Linux. There is no harm to using the typical <code class="language-plaintext highlighter-rouge">mount</code> command as the extended attributes showing the ADS will still be present, regardless of whether the driver is used or not. However, I chose to explicitly use the Linux NTFS driver for the following reasons; I could specify the attribute I wanted in the output streams, and large ADS files report an error if you try to read their contents without the NTFS driver. Overall, I used the NTFS driver to make the ADS output easier to manage and more reliable.</p><h2 id="concluding-statements">Concluding Statements</h2><p>The experimentation conducted as part of this article set out to determine a reliable method for locating and extracting Alternate Data Streams from an NTFS partition using Linux commands. It was found that by forensically mounting the partition to the Linux host and reading the extended attributes of the files it contains, ADS could be identified. Should any of the ADS prove suspicious or warrant further investigation, the experimentation showed that Sleuth Kit commands could extract the data from these files.</p><p>Of course, the overall forensic relevance of ADS can be debated, however I think they are a very important aspect of Windows forensics due to their potential for Anti-Forensics. Additionally, the NTFS Alternate Data Streams have provided other useful artifacts to forensic examiners in the form of Zone Identifiers. Finally, the history ADS have in the field of information security means they could be a useful source of information to those in Incident Response.</p><p>If you have any recommendations or questions about the topics mentioned in this article, you can contact me on <a href="https://twitter.com/AstrumMairi">Twitter</a>.</p><p>– Mairi</p><h2 id="references">References</h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>Abrams, L. (2004). <a href="https://www.bleepingcomputer.com/tutorials/windows-alternate-data-streams/">Windows Alternate Data Streams</a> [Accessed 2018-06-22] <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:2" role="doc-endnote"><p>Leibovich, T. (2018). <a href="https://www.deepinstinct.com/2018/06/12/the-abuse-of-alternate-data-stream-hasnt-disappeared/">The Abuse of Alternate Data Stream Hasn’t Disappeared</a> [Accessed 2018-06-22] <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:3" role="doc-endnote"><p>Broomfield, M. (2006). <em>NTFS Alternate Data Streams: focused hacking</em>. Network Security: Volume 2006, Issue 8 <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:4" role="doc-endnote"><p>Shamblin, Q. (2008). <a href="https://www.sans.org/blog/alternate-data-streams-overview/">Alternate Data Streams Overview</a> [Accessed 2018-06-22] <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:5" role="doc-endnote"><p>Fitzsimons, J. (2011). <a href="https://www.curlybrace.com/words/2011/01/01/alternate-data-streams/">Alternate Data Streams (Metadata) on Files in NTFS</a> [Accessed 2018-06-22] <a href="#fnref:5" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:6" role="doc-endnote"><p>Arntz, P. (2016). <a href="https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/"> Introduction to Alternate Data Streams</a> [Accessed 2018-06-22] <a href="#fnref:6" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:7" role="doc-endnote"><p>Cyber Fibers. (2015). <a href="https://cyberfibers.com/2015/11/detecting-alternate-data-streams-with-powershell-and-dos/">Detecting Alternate Data Streams with PowerShell and DOS</a> [Accessed 2018-06-22] <a href="#fnref:7" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:8" role="doc-endnote"><p>Linux Man Page. <a href="https://linux.die.net/man/8/ntfsmount">ntfsmount</a> [Accessed 2018-06-22] <a href="#fnref:8" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dfir/'>DFIR</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dfir/" class="post-tag no-text-decoration" >dfir</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Extracting Alternate Data Streams with Linux - Mairi's Blog&url=https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Extracting Alternate Data Streams with Linux - Mairi's Blog&u=https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Extracting Alternate Data Streams with Linux - Mairi's Blog&url=https://tmairi.github.io/posts/extracting-alternate-data-streams-with-linux/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dissecting-the-ad1-file-format/">Dissecting the AD1 File Format</a><li><a href="/posts/exploring-ieee-754-arithmetic/">Exploring IEEE 754 Arithmetic</a><li><a href="/posts/LNKPARSER/">Forensic BASH Scripting: LNK Parsing</a><li><a href="/posts/forensic-aquisition-with-dd-tools/">Forensic Acquisition with DD Tools</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/dfir/">dfir</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/scripting/">scripting</a> <a class="post-tag" href="/tags/mathematics/">mathematics</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/forensic-aquisition-with-dd-tools/"><div class="card-body"> <span class="timeago small" > Jan 28 <i class="unloaded">2018-01-28T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Forensic Acquisition with DD Tools</h3><div class="text-muted small"><p> Foreword This article will be focusing on the usage of the Linux tool dd in the forensic imaging process, along with several tools that have been derived from it. In addition to briefly covering t...</p></div></div></a></div><div class="card"> <a href="/posts/LNKPARSER/"><div class="card-body"> <span class="timeago small" > Apr 8 <i class="unloaded">2021-04-08T20:56:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Forensic BASH Scripting: LNK Parsing</h3><div class="text-muted small"><p> Forensic BASH script: lnkparser Observation Recently, while probing a Windows image file in my spare time, I came across a plethora of user-generated Windows shortcut files, also known as LNK fil...</p></div></div></a></div><div class="card"> <a href="/posts/dissecting-the-ad1-file-format/"><div class="card-body"> <span class="timeago small" > Jun 19 <i class="unloaded">2021-06-19T23:48:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dissecting the AD1 File Format</h3><div class="text-muted small"><p> Foreword This article will be covering my personal exploration and dissection of the proprietary AccessData image format known as the AccessData Logial Image. This format is also referred to as AD...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/forensic-aquisition-with-dd-tools/" class="btn btn-outline-primary" prompt="Older"><p>Forensic Acquisition with DD Tools</p></a> <a href="/posts/LNKPARSER/" class="btn btn-outline-primary" prompt="Newer"><p>Forensic BASH Scripting: LNK Parsing</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/AstrumMairi">Mairi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/dfir/">dfir</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/scripting/">scripting</a> <a class="post-tag" href="/tags/mathematics/">mathematics</a> <a class="post-tag" href="/tags/windows/">windows</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://tmairi.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
